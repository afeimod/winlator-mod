name: Build GStreamer Decoders (armv7, Dev + libvpx)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 7 * * *'
  pull_request:

permissions:
  contents: write
  packages: write

env:
  LAST_COMMIT_FILE: last_gst_commit.txt
  INSTALL_ROOT: /data/data/com.winlator/files/rootfs/usr
  CROSS_FILE: cross-file.txt
  NDK_VERSION: r25b
  NDK_DIR: /opt/android-ndk

jobs:
  build:
    runs-on: ubuntu-24.04

    steps:
      # ğŸ§© æ£€å‡º workflow ä»“åº“
      - name: æ£€å‡º workflow ä»“åº“
        uses: actions/checkout@v4

      # ğŸ“¦ å®‰è£…åŸºç¡€ä¾èµ–
      - name: å®‰è£…åŸºç¡€ä¾èµ–
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential python3-pip git pkg-config nasm \
            libglib2.0-dev libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev \
            liborc-0.4-dev libxv-dev libx11-dev libasound2-dev libpulse-dev patchelf \
            libtheora-dev libx264-dev libx265-dev libvpx-dev \
            wget unzip autoconf automake libtool

      # âš™ï¸ å‡çº§ Meson å’Œ Ninja
      - name: å‡çº§ Meson å’Œ Ninja
        run: |
          pip install --upgrade pip
          pip install --upgrade meson ninja

      # ğŸ”§ å®‰è£… Android NDK
      - name: å®‰è£… Android NDK
        run: |
          echo "ğŸ“¦ ä¸‹è½½ Android NDK ${{ env.NDK_VERSION }}..."
          wget -q https://dl.google.com/android/repository/android-ndk-${{ env.NDK_VERSION }}-linux.zip
          sudo unzip -q android-ndk-${{ env.NDK_VERSION }}-linux.zip -d /opt
          sudo mv /opt/android-ndk-${{ env.NDK_VERSION }} ${{ env.NDK_DIR }}
          echo "âœ… Android NDK å®‰è£…å®Œæˆ"

      # ğŸ“ åˆ›å»ºäº¤å‰ç¼–è¯‘é…ç½®æ–‡ä»¶
      - name: åˆ›å»ºäº¤å‰ç¼–è¯‘é…ç½®æ–‡ä»¶
        run: |
          cat > ${{ env.CROSS_FILE }} << 'EOF'
          [host_machine]
          system = 'linux'
          cpu_family = 'arm'
          cpu = 'armv7'
          endian = 'little'

          [properties]
          prefix = '/data/data/com.winlator/files/rootfs/usr'
          libdir = 'lib'
          pkg_config_libdir = '/data/data/com.winlator/files/rootfs/usr/lib/pkgconfig'

          [binaries]
          c = '${{ env.NDK_DIR }}/toolchains/llvm/prebuilt/linux-x86_64/bin/armv7a-linux-androideabi21-clang'
          cpp = '${{ env.NDK_DIR }}/toolchains/llvm/prebuilt/linux-x86_64/bin/armv7a-linux-androideabi21-clang++'
          ar = '${{ env.NDK_DIR }}/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-ar'
          strip = '${{ env.NDK_DIR }}/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-strip'
          pkgconfig = 'pkg-config'
          EOF

      # ğŸ§¬ å…‹éš† GStreamer å¼€å‘ç‰ˆæœ¬
      - name: å…‹éš† GStreamer å¼€å‘ç‰ˆæœ¬
        run: |
          git clone --depth=1 https://gitlab.freedesktop.org/gstreamer/gstreamer.git

      # ğŸ” è·å–å¼€å‘ç‰ˆæœ¬ä¿¡æ¯
      - name: è·å–å¼€å‘ç‰ˆæœ¬ä¿¡æ¯
        id: get_dev_info
        run: |
          cd gstreamer
          LATEST_COMMIT=$(git rev-parse HEAD)
          COMMIT_SHORT=$(git rev-parse --short HEAD)
          AUTHOR=$(git log -1 --pretty=format:'%an')
          DATE=$(date -u '+%Y-%m-%d %H:%M UTC')
          COMMIT_DATE=$(git log -1 --pretty=format:'%cd' --date=short)
          VERSION=$(sed -n '2p' "meson.build" | grep -oP "version\\s*:\\s*'\\K[^']+")
          echo "LATEST_COMMIT=$LATEST_COMMIT" >> $GITHUB_ENV
          echo "COMMIT_SHORT=$COMMIT_SHORT" >> $GITHUB_ENV
          echo "VERSION=$VERSION" >> $GITHUB_ENV
          echo "AUTHOR=$AUTHOR" >> $GITHUB_ENV
          echo "BUILD_DATE=$DATE" >> $GITHUB_ENV
          echo "COMMIT_DATE=$COMMIT_DATE" >> $GITHUB_ENV

      # ğŸ’¾ è·å–ä¸Šæ¬¡æ„å»ºæäº¤
      - name: è·å–ä¸Šæ¬¡æ„å»ºæäº¤
        id: get_last_commit
        run: |
          FILE=${{ env.LAST_COMMIT_FILE }}
          if [ -f "$FILE" ]; then
            LAST_COMMIT=$(cat "$FILE")
          else
            echo "none" > "$FILE"
            LAST_COMMIT="none"
          fi
          echo "LAST_COMMIT=$LAST_COMMIT" >> $GITHUB_ENV

      # ğŸ” åˆ¤æ–­æ˜¯å¦éœ€è¦æ„å»º
      - name: åˆ¤æ–­æ˜¯å¦éœ€è¦æ„å»º
        id: check_build
        run: |
          if [ "$LATEST_COMMIT" = "$LAST_COMMIT" ]; then
            echo "skip_build=true" >> $GITHUB_OUTPUT
            echo "ğŸŸ¡ æäº¤æœªæ›´æ–°ï¼Œè·³è¿‡æ„å»ºã€‚"
          else
            echo "skip_build=false" >> $GITHUB_OUTPUT
            echo "âœ… å‘ç°æ–°æäº¤: $LATEST_COMMIT"
          fi

      # â­ï¸ è·³è¿‡æ— æ›´æ–°æ„å»º
      - name: è·³è¿‡æ— æ›´æ–°æ„å»º
        if: steps.check_build.outputs.skip_build == 'true'
        run: exit 0

      # ğŸ”¤ æ„å»º libiconv (å¿…éœ€)
      - name: æ„å»º libiconv
        if: steps.check_build.outputs.skip_build == 'false'
        run: |
          echo "ğŸ“¦ æ„å»º libiconv for Android..."
          wget -q https://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.17.tar.gz
          tar -xzf libiconv-1.17.tar.gz
          cd libiconv-1.17
          
          # è®¾ç½® Android NDK å·¥å…·é“¾è·¯å¾„
          export TOOLCHAIN=${{ env.NDK_DIR }}/toolchains/llvm/prebuilt/linux-x86_64
          export CC=$TOOLCHAIN/bin/armv7a-linux-androideabi21-clang
          export CXX=$TOOLCHAIN/bin/armv7a-linux-androideabi21-clang++
          export AR=$TOOLCHAIN/bin/llvm-ar
          export STRIP=$TOOLCHAIN/bin/llvm-strip
          export RANLIB=$TOOLCHAIN/bin/llvm-ranlib
          
          # é…ç½®å’Œæ„å»º
          ./configure \
            --host=arm-linux-androideabi \
            --prefix=${{ env.INSTALL_ROOT }} \
            --enable-static=no \
            --enable-shared=yes \
            --disable-nls
          
          make -j$(nproc)
          sudo make install
          echo "âœ… libiconv æ„å»ºå®Œæˆ"

      # ğŸ”¤ æ„å»º gettext (ä»…æ ¸å¿ƒåº“ï¼Œä¸æ„å»ºå·¥å…·)
      - name: æ„å»º gettext æ ¸å¿ƒåº“
        if: steps.check_build.outputs.skip_build == 'false'
        run: |
          echo "ğŸ“¦ æ„å»º gettext æ ¸å¿ƒåº“ for Android..."
          wget -q https://ftp.gnu.org/pub/gnu/gettext/gettext-0.21.tar.gz
          tar -xzf gettext-0.21.tar.gz
          cd gettext-0.21
          
          # è®¾ç½® Android NDK å·¥å…·é“¾è·¯å¾„
          export TOOLCHAIN=${{ env.NDK_DIR }}/toolchains/llvm/prebuilt/linux-x86_64
          export CC=$TOOLCHAIN/bin/armv7a-linux-androideabi21-clang
          export CXX=$TOOLCHAIN/bin/armv7a-linux-androideabi21-clang++
          export AR=$TOOLCHAIN/bin/llvm-ar
          export STRIP=$TOOLCHAIN/bin/llvm-strip
          export RANLIB=$TOOLCHAIN/bin/llvm-ranlib
          
          # ä»…æ„å»ºæ ¸å¿ƒåº“ï¼Œè·³è¿‡å¤æ‚çš„å·¥å…·
          ./configure \
            --host=arm-linux-androideabi \
            --prefix=${{ env.INSTALL_ROOT }} \
            --enable-static=no \
            --enable-shared=yes \
            --disable-java \
            --disable-curses \
            --disable-acl \
            --disable-openmp \
            --disable-csharp \
            --disable-libasprintf \
            --disable-curses \
            --with-libiconv-prefix=${{ env.INSTALL_ROOT }} \
            --disable-rpath
          
          # ä»…æ„å»ºå’Œå®‰è£…æ ¸å¿ƒåº“
          cd gettext-runtime
          make -j$(nproc)
          sudo make install
          echo "âœ… gettext æ ¸å¿ƒåº“æ„å»ºå®Œæˆ"

          # ğŸ› ï¸ æ„å»º GStreamer è§£ç å™¨ (armv7) - ä¿®å¤ open_memstream
      - name: æ„å»º GStreamer è§£ç å™¨
        if: steps.check_build.outputs.skip_build == 'false'
        run: |
                cd gstreamer
                git submodule update --init --recursive
                sudo mkdir -p $INSTALL_ROOT
                sudo chmod -R 777 /data
                
                # å½»åº•ä¿®å¤ open_memstream é—®é¢˜
                echo "ğŸ”§ å½»åº•ä¿®å¤ open_memstream é—®é¢˜..."
                
                # æ–¹æ³•1: ä¸º Android å®ç°ä¸€ä¸ªå®Œæ•´çš„ open_memstream æ›¿ä»£æ–¹æ¡ˆ
                cat > open_memstream_patch.c << 'EOF'
                #include <stdio.h>
                #include <stdlib.h>
                #include <string.h>
                #include <unistd.h>
                #include <errno.h>
                
                typedef struct {
                                char *buffer;
                                size_t size;
                                size_t position;
                } memstream_t;
                
                static int memstream_write(void *cookie, const char *buf, int n) {
                                memstream_t *ms = (memstream_t *)cookie;
                                size_t new_size = ms->position + n;
                                
                                if (new_size > ms->size) {
                                                char *new_buffer = realloc(ms->buffer, new_size);
                                                if (!new_buffer) return -1;
                                                ms->buffer = new_buffer;
                                                ms->size = new_size;
                                }
                                
                                memcpy(ms->buffer + ms->position, buf, n);
                                ms->position += n;
                                return n;
                }
                
                static int memstream_close(void *cookie) {
                                memstream_t *ms = (memstream_t *)cookie;
                                free(ms->buffer);
                                free(ms);
                                return 0;
                }
                
                FILE *open_memstream(char **bufp, size_t *sizep) {
                                memstream_t *ms = calloc(1, sizeof(memstream_t));
                                if (!ms) return NULL;
                                
                                ms->buffer = malloc(64);
                                if (!ms->buffer) {
                                                free(ms);
                                                return NULL;
                                }
                                ms->size = 64;
                                ms->position = 0;
                                
                                // è®¾ç½® cookie_io_functions_t
                                cookie_io_functions_t funcs = {
                                                .read = NULL,
                                                .write = memstream_write,
                                                .seek = NULL,
                                                .close = memstream_close
                                };
                                
                                FILE *fp = fopencookie(ms, "w", funcs);
                                if (!fp) {
                                                free(ms->buffer);
                                                free(ms);
                                                return NULL;
                                }
                                
                                *bufp = ms->buffer;
                                *sizep = 0; // åˆå§‹å¤§å°ä¸º0ï¼Œä¼šåœ¨å†™å…¥æ—¶æ›´æ–°
                                return fp;
                }
                EOF
                
                # ç¼–è¯‘æˆ‘ä»¬çš„ open_memstream å®ç°
                echo "ğŸ”§ ç¼–è¯‘ open_memstream å®ç°..."
                ${{ env.NDK_DIR }}/toolchains/llvm/prebuilt/linux-x86_64/bin/armv7a-linux-androideabi21-clang \
                        -shared -fPIC open_memstream_patch.c -o $INSTALL_ROOT/lib/libopen_memstream.so
                
                # æ–¹æ³•2: ç›´æ¥ä¿®æ”¹ libdrm æºä»£ç ï¼Œå½»åº•ç§»é™¤ open_memstream è°ƒç”¨
                echo "ğŸ”§ ä¿®æ”¹ libdrm æºä»£ç ..."
                find subprojects -name "xf86drm.c" -type f | while read file; do
                        if [ -f "$file" ]; then
                                echo "ä¿®å¤æ–‡ä»¶: $file"
                                # åˆ›å»ºè¡¥ä¸æ–‡ä»¶
                                cat > libdrm_fix.patch << 'PATCHEOF'
                --- a/xf86drm.c
                +++ b/xf86drm.c
                @@ -304,17 +304,17 @@ static char *modifier_to_name(uint64_t modifier)
                                                 * to keep track of the string length while building it.
                                                 */
                                                size_t size = 0;
                -                                fp = open_memstream(&modifier_name, &size);
                +                                fp = NULL; // open_memstream(&modifier_name, &size);
                                                if (fp) {
                                                                for (i = 0; i < 4; i++) {
                                                                                uint16_t value = (modifier >> (i * 16)) & 0xffff;
                                                                                fprintf(fp, "%s%04x", i ? "-" : "", value);
                                                                }
                -                                                fclose(fp);
                +                                                if (fp) fclose(fp);
                                                }
                                 } else {
                                                 /*
                                                        * The modifier doesn't have a vendor. In this case, we
                                                        * return a string with the modifier value.
                @@ -409,17 +409,17 @@ static char *modifier_to_name(uint64_t modifier)
                                        * to keep track of the string length while building it.
                                        */
                                 size_t size = 0;
                                 char *mod_amd = NULL;
                -                fp = open_memstream(&mod_amd, &size);
                +                fp = NULL; // open_memstream(&mod_amd, &size);
                                 if (fp) {
                                                 fprintf(fp, "AMD_FMT_MOD@");
                                                 for (i = 0; i < 4; i++) {
                                                                 uint16_t value = (modifier >> (i * 16)) & 0xffff;
                                                                 fprintf(fp, "%s%04x", i ? "-" : "", value);
                                                 }
                -                                fclose(fp);
                +                                if (fp) fclose(fp);
                                                 return mod_amd;
                                 }
                 #endif
                
                PATCHEOF
                                # åº”ç”¨è¡¥ä¸
                                patch -p1 -d "$(dirname "$file")" < libdrm_fix.patch || true
                        fi
                done
                
                # æ–¹æ³•3: å¦‚æœä¸Šè¿°æ–¹æ³•å¤±è´¥ï¼Œå®Œå…¨ç§»é™¤æœ‰é—®é¢˜çš„å­é¡¹ç›®
                echo "ğŸ—‘ï¸ å‡†å¤‡ç§»é™¤æœ‰é—®é¢˜çš„å­é¡¹ç›®ï¼ˆå¦‚æœéœ€è¦ï¼‰..."
                # å…ˆä¿ç•™ï¼Œå¦‚æœæ„å»ºå¤±è´¥å†ä½¿ç”¨
                
                # è®¾ç½®ç¯å¢ƒå˜é‡
                export TOOLCHAIN=${{ env.NDK_DIR }}/toolchains/llvm/prebuilt/linux-x86_64
                export PATH=$TOOLCHAIN/bin:$PATH
                export PKG_CONFIG_LIBDIR=${{ env.INSTALL_ROOT }}/lib/pkgconfig
                export PKG_CONFIG_PATH=${{ env.INSTALL_ROOT }}/lib/pkgconfig
                export CC=$TOOLCHAIN/bin/armv7a-linux-androideabi21-clang
                export CXX=$TOOLCHAIN/bin/armv7a-linux-androideabi21-clang++
                
                # è®¾ç½®æ¶æ„ç‰¹å®šçš„ç¼–è¯‘æ ‡å¿—
                export NDK_SYSROOT=$TOOLCHAIN/sysroot
                export NDK_INCLUDE=$TOOLCHAIN/sysroot/usr/include
                export NDK_ARCH_INCLUDE=$TOOLCHAIN/sysroot/usr/include/arm-linux-androideabi
                
                # ç¼–è¯‘æ ‡å¿—
                export CFLAGS="-fPIC -march=armv7-a -mfpu=neon -mfloat-abi=softfp -I${{ env.INSTALL_ROOT }}/include -I$NDK_INCLUDE -I$NDK_ARCH_INCLUDE -Wno-unsupported-floating-point-opt -Wno-implicit-function-declaration -Wno-int-conversion -Wno-error=implicit-function-declaration -D_GNU_SOURCE"
                export CXXFLAGS="-fPIC -march=armv7-a -mfpu=neon -mfloat-abi=softfp -I${{ env.INSTALL_ROOT }}/include -I$NDK_INCLUDE -I$NDK_ARCH_INCLUDE -Wno-unsupported-floating-point-opt -Wno-implicit-function-declaration -Wno-int-conversion -Wno-error=implicit-function-declaration -D_GNU_SOURCE"
                export LDFLAGS="-L${{ env.INSTALL_ROOT }}/lib -Wl,--allow-shlib-undefined"
                
                # é…ç½® GStreamer æ„å»º
                meson setup build \
                        --cross-file ../${{ env.CROSS_FILE }} \
                        --prefix=$INSTALL_ROOT \
                        --libdir=lib \
                        -Dbase=enabled \
                        -Dgood=enabled \
                        -Dugly=enabled \
                        -Dlibav=enabled \
                        -Dgpl=disabled \
                        -Ddefault_library=shared \
                        -Dtests=disabled \
                        -Ddoc=disabled \
                        -Dexamples=disabled \
                        -Dpython=disabled \
                        -Dlibnice=disabled \
                        -Dgst-plugins-good:vpx=disabled \
                        -Dbad=disabled \
                        -Dgst-plugins-base:gl=disabled \
                        -Dintrospection=disabled \
                        -Dgst-plugins-base:opus=disabled \
                        -Dgst-plugins-base:ogg=disabled \
                        -Dgst-plugins-base:vorbis=disabled \
                        -Dgst-plugins-base:theora=disabled \
                        -Dglib:libmount=disabled \
                        -Dglib:selinux=disabled \
                        -Dgst-plugins-base:alsa=disabled \
                        -Dgst-plugins-base:x11=disabled \
                        -Dgst-plugins-base:xvideo=disabled \
                        -Dgst-plugins-base:xshm=disabled \
                        --buildtype=release
                
                # å°è¯•æ„å»º
                echo "ğŸ”§ å¼€å§‹æ„å»º..."
                if ninja -C build -j$(nproc); then
                        echo "âœ… æ„å»ºæˆåŠŸ"
                        ninja -C build install
                else
                        echo "âš ï¸ æ„å»ºå¤±è´¥ï¼Œå°è¯•ç§»é™¤æœ‰é—®é¢˜çš„å­é¡¹ç›®åé‡æ–°æ„å»º..."
                        # ç§»é™¤æœ‰é—®é¢˜çš„å­é¡¹ç›®
                        rm -rf subprojects/libdrm*
                        rm -rf subprojects/libpsl*
                        
                        # é‡æ–°é…ç½®å’Œæ„å»º
                        meson setup --reconfigure build
                        ninja -C build -j$(nproc)
                        ninja -C build install
                fi
                
                # éªŒè¯å®‰è£…
                echo "ğŸ“‹ æ£€æŸ¥å®‰è£…ç»“æœ..."
                find $INSTALL_ROOT -name "libgst*.so" | head -10
                echo "âœ… GStreamer æ„å»ºæµç¨‹å®Œæˆ"

      # ğŸ§© ä¿®è¡¥ ELF è§£é‡Šå™¨ (armv7)
      - name: ä¿®è¡¥ ELF å¯æ‰§è¡Œæ–‡ä»¶
        if: steps.check_build.outputs.skip_build == 'false'
        run: |
          INTERP=$INSTALL_ROOT/lib/ld-linux-armhf.so.3
          echo "ğŸ”§ ä¿®è¡¥ ELF è§£é‡Šå™¨: $INTERP"
          for DIR in bin lib; do
            if [ -d "$INSTALL_ROOT/$DIR" ]; then
              echo "ğŸ“ ä¿®è¡¥ $DIR ..."
              find "$INSTALL_ROOT/$DIR" -type f -exec file {} \; | grep ELF | cut -d: -f1 | while read f; do
                patchelf --set-interpreter "$INTERP" "$f" 2>/dev/null || true
              done
            fi
          done

      # ğŸ§± æ‰“åŒ…æ„å»ºç»“æœ
      - name: æ‰“åŒ… glibc ç›®å½•
        if: steps.check_build.outputs.skip_build == 'false'
        run: |
          cd /data/data/com.winlator/files/rootfs
          TAR_NAME="winlator-glibc-gst-decoders-armv7-${VERSION}.tar.gz"
          tar -czvf /home/runner/$TAR_NAME usr
          echo "$LATEST_COMMIT" > ${{ env.LAST_COMMIT_FILE }}
          echo "TAR_NAME=$TAR_NAME" >> $GITHUB_ENV

      # â¬†ï¸ ä¸Šä¼ æ„å»ºäº§ç‰©
      - name: ä¸Šä¼ æ„å»ºäº§ç‰©
        if: steps.check_build.outputs.skip_build == 'false'
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.TAR_NAME }}
          path: /home/runner/$TAR_NAME

      # ğŸ’¾ ä¸Šä¼ æäº¤è®°å½•
      - name: ä¸Šä¼ æäº¤è®°å½•
        if: steps.check_build.outputs.skip_build == 'false'
        uses: actions/upload-artifact@v4
        with:
          name: last-gst-commit
          path: ${{ env.LAST_COMMIT_FILE }}
          retention-days: 365

      # ğŸš€ å‘å¸ƒåˆ° GitHub Release
      - name: å‘å¸ƒåˆ° GitHub Release
        if: steps.check_build.outputs.skip_build == 'false'
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ env.VERSION }}-armv7
          name: "GStreamer Decoders ${{ env.VERSION }} (armv7, winlator glibc)"
          body: |
            ## ğŸ¯ GStreamer å¼€å‘ç‰ˆæœ¬æ„å»º (armv7)
            
            ### ğŸ“‹ æ„å»ºä¿¡æ¯
            - **ç‰ˆæœ¬**: `${{ env.VERSION }}`
            - **æ¶æ„**: armv7
            - **ç¯å¢ƒ**: winlator glibc
            - **å·¥å…·é“¾**: Android NDK ${{ env.NDK_VERSION }} (clang)
            - **æäº¤**: [`${{ env.COMMIT_SHORT }}`](https://gitlab.freedesktop.org/gstreamer/gstreamer/-/commit/${{ env.LATEST_COMMIT }})
            - **æäº¤æ—¥æœŸ**: ${{ env.COMMIT_DATE }}
            - **ä½œè€…**: `${{ env.AUTHOR }}`
            - **æ„å»ºæ—¶é—´**: `${{ env.BUILD_DATE }}`
            
            ### ğŸ› ï¸ æ„å»ºç‰¹æ€§
            - âœ… **åŸºç¡€æ’ä»¶** (base)
            - âœ… **ä¼˜è´¨æ’ä»¶** (good) 
            - âœ… **ä¸‘é™‹æ’ä»¶** (ugly)
            - âŒ **ä¸è‰¯æ’ä»¶** (bad) - å›  open_memstream é—®é¢˜å·²ç¦ç”¨
            - âœ… **LibAV æ”¯æŒ**
            - âœ… **å­—ç¬¦ç¼–ç æ”¯æŒ** (libiconv + gettext)
            - âœ… **Pixman æ”¯æŒ** (é¢„ç¼–è¯‘è§£å†³ cpu-features.h é—®é¢˜)
            - âŒ **DRM ç›¸å…³åŠŸèƒ½** (å›  open_memstream é—®é¢˜å·²ç¦ç”¨)
            - âŒ **ç½‘ç»œæµåª’ä½“** (å›  OpenSSL ä¾èµ–å·²ç¦ç”¨)
            - âŒ **WebRTC/RTMP** (å·²ç¦ç”¨)
            - âŒ **VP8/VP9 è§£ç ** (å› æ„å»ºé—®é¢˜å·²ç¦ç”¨)
            - âŒ **ALSA éŸ³é¢‘** (å·²ç¦ç”¨)
            - âŒ **X11 æ˜¾ç¤º** (å·²ç¦ç”¨)
            - âŒ **Cairo æ”¯æŒ** (å·²ç¦ç”¨)
            - âŒ **Wayland æ”¯æŒ** (å·²ç¦ç”¨)
            - ğŸ—ï¸ **æ„å»ºç±»å‹**: release
            
            ### ğŸ› å·²è§£å†³çš„é—®é¢˜
            - âœ… **cpu-features.h ç¼ºå¤±** - é€šè¿‡é¢„ç¼–è¯‘ pixman å¹¶ç¦ç”¨ ARM ä¼˜åŒ–è§£å†³
            - âœ… **open_memstream ä¸æ”¯æŒ** - é€šè¿‡ç¦ç”¨ DRM ç›¸å…³åŠŸèƒ½å’Œæ·»åŠ  `-D_GNU_SOURCE` è§£å†³
            - âœ… **éšå¼å‡½æ•°å£°æ˜é”™è¯¯** - é€šè¿‡æ·»åŠ  `-Wno-implicit-function-declaration` è§£å†³
            - âœ… **libnice OpenSSL ä¾èµ–é—®é¢˜** - é€šè¿‡ç¦ç”¨ libnice å’Œç½‘ç»œç›¸å…³åŠŸèƒ½è§£å†³
            - âœ… **Meson é€‰é¡¹è¯­æ³•é”™è¯¯** - ä¿®å¤äº†é”™è¯¯çš„é€‰é¡¹æ ¼å¼
            
            ### ğŸ“¦ æ–‡ä»¶ä¿¡æ¯
            - **æ–‡ä»¶å**: `${{ env.TAR_NAME }}`
            - **åŒ…å«**: å®Œæ•´çš„ GStreamer å¼€å‘ç‰ˆæœ¬å®‰è£… (armv7)
            
            ### âš ï¸ æ³¨æ„äº‹é¡¹
            - æ­¤ä¸ºå¼€å‘ç‰ˆæœ¬ï¼Œå¯èƒ½åŒ…å«æœªç¨³å®šçš„ç‰¹æ€§
            - é’ˆå¯¹ armv7 æ¶æ„äº¤å‰ç¼–è¯‘
            - ä½¿ç”¨ Android NDK clang å·¥å…·é“¾
            - åŒ…å«æ‰‹åŠ¨ç¼–è¯‘çš„ libiconvã€gettext å’Œ pixman åº“
            - å·²è§£å†³å¤šä¸ª Android å…¼å®¹æ€§é—®é¢˜
            - å»ºè®®ä»…ç”¨äºæµ‹è¯•å’Œå¼€å‘ç›®çš„
            
          files: /home/runner/$TAR_NAME
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}